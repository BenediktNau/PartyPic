(()=>{"use strict";var t={n:e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},d:(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>m,options:()=>c,setup:()=>h,teardown:()=>f});const s=require("k6/http");var n=t.n(s);const a=require("k6"),o=require("k6/metrics"),r=new o.Rate("errors"),d=new o.Trend("request_duration"),i=new o.Counter("successful_requests"),u=__ENV.BASE_URL||"http://app.100.50.133.182.nip.io",p=__ENV.API_URL||"http://api.100.50.133.182.nip.io",c={scenarios:{ramp_up_test:{executor:"ramping-vus",startVUs:0,stages:[{duration:"30s",target:10},{duration:"1m",target:50},{duration:"2m",target:100},{duration:"2m",target:100},{duration:"1m",target:50},{duration:"30s",target:0}],gracefulRampDown:"30s"}},thresholds:{http_req_duration:["p(95)<2000"],errors:["rate<0.1"],http_req_failed:["rate<0.1"]}},l=[{username:"testuser1",password:"password123"},{username:"testuser2",password:"password123"},{username:"loadtest",password:"loadtest123"}];function g(t,e){return Math.random()*(e-t)+t}function m(){const t=l[Math.floor(Math.random()*l.length)];(0,a.group)("Frontend Load",()=>{const t=n().get(u,{tags:{name:"MainPage"}});(0,a.check)(t,{"Main page status is 200":t=>200===t.status,"Main page loads fast":t=>t.timings.duration<1e3}),r.add(200!==t.status),d.add(t.timings.duration),200===t.status&&i.add(1),(0,a.sleep)(g(.5,1))}),(0,a.group)("API Load",()=>{const e=n().get(`${p}/`,{tags:{name:"HealthCheck"}});(0,a.check)(e,{"API health check returns 200":t=>200===t.status}),r.add(200!==e.status),200===e.status&&i.add(1),(0,a.sleep)(g(.3,.7));const s=JSON.stringify({username:t.username,password:t.password}),o=n().post(`${p}/auth/login`,s,{headers:{"Content-Type":"application/json"},tags:{name:"Login"}});(0,a.check)(o,{"Login endpoint responds":t=>200===t.status||401===t.status}),d.add(o.timings.duration),(0,a.sleep)(g(.5,1.5))}),(0,a.group)("Session Operations",()=>{const t=n().get(`${p}/sessions`,{tags:{name:"GetSessions"}});(0,a.check)(t,{"Sessions endpoint responds":t=>200===t.status||401===t.status}),200===t.status&&i.add(1),(0,a.sleep)(g(.5,2))}),(0,a.group)("Metrics Endpoint",()=>{const t=n().get(`${p}/metrics`,{tags:{name:"Metrics"}});(0,a.check)(t,{"Metrics endpoint responds":t=>200===t.status,"Metrics contain prometheus format":t=>null!==t.body&&"string"==typeof t.body&&t.body.includes("partypic_")}),200===t.status&&i.add(1),(0,a.sleep)(g(1,3))})}function h(){console.log(`\n╔════════════════════════════════════════════════════════════════╗\n║              PartyPic Load Test - Autoscaling Demo             ║\n╠════════════════════════════════════════════════════════════════╣\n║  Frontend URL: ${u.padEnd(44)}║\n║  API URL:      ${p.padEnd(44)}║\n╠════════════════════════════════════════════════════════════════╣\n║  Scenario: Ramp-up test for HPA scaling demonstration          ║\n║  - Warm-up:       30s  (0 -> 10 VUs)                           ║\n║  - Ramp-up:       1m   (10 -> 50 VUs)                          ║\n║  - Peak Load:     2m   (50 -> 100 VUs)                         ║\n║  - Sustained:     2m   (100 VUs)                               ║\n║  - Scale-down:    1m   (100 -> 50 VUs)                         ║\n║  - Cool-down:     30s  (50 -> 0 VUs)                           ║\n╚════════════════════════════════════════════════════════════════╝\n  `);const t=n().get(u),e=n().get(p);return 200!==t.status&&console.warn(`⚠️  Frontend not reachable: ${t.status}`),200!==e.status&&console.warn(`⚠️  API not reachable: ${e.status}`),{startTime:(new Date).toISOString()}}function f(t){console.log(`\n╔════════════════════════════════════════════════════════════════╗\n║                    Load Test Complete                          ║\n╠════════════════════════════════════════════════════════════════╣\n║  Started:  ${t.startTime.padEnd(48)}║\n║  Finished: ${(new Date).toISOString().padEnd(48)}║\n╠════════════════════════════════════════════════════════════════╣\n║  Check Grafana for scaling metrics:                            ║\n║  - Pod replica count changes                                   ║\n║  - CPU/Memory utilization                                      ║\n║  - Request rate and latency                                    ║\n╚════════════════════════════════════════════════════════════════╝\n  `)}var _=exports;for(var y in e)_[y]=e[y];e.__esModule&&Object.defineProperty(_,"__esModule",{value:!0})})();