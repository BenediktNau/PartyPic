
Aktivierung der Extension pgcrypto zur generierung uuid
CREATE EXTENSION IF NOT EXISTS "pgcrypto";

CREATE TABLE pictures (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    u_name VARCHAR(255) NOT NULL,
    mission_id ID,
    session_id UUID NOT NULL,
    original_filename VARCHAR(255) NOT NULL,
    s3_key VARCHAR(255) NOT NULL,
    s3_bucket VARCHAR(100) NOT NULL,
    
    mimetype VARCHAR(100),
    filesize_bytes BIGINT,

    CONSTRAINT unique_s3_key UNIQUE(s3_key)
);

CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    name VARCHAR(255) NOT NULL ,
    email VARCHAR(255) NOT NULL,
    password VARCHAR(255) NOT NULL,
    
    CONSTRAINT unique_email UNIQUE(email)
);


CREATE TABLE sessions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    settings JSON,
    missions JSON,
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    ends_at TIMESTAMPTZ NOT NULL DEFAULT NOW() + INTERVAL '7 days',

    user_id UUID REFERENCES users(id)

);

CREATE TABLE session_users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_name VARCHAR(50),
    session_id UUID REFERENCES sessions(id),
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);



Indezes für Schnelle Suche möglicherweise später Interessant?
CREATE INDEX idx_pictures_session_id ON pictures(session_id);


CREATE INDEX idx_pictures_u_name ON pictures(u_name);